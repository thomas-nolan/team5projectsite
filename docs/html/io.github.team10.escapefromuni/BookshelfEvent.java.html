<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BookshelfEvent.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core</a> &gt; <a href="index.source.html" class="el_package">io.github.team10.escapefromuni</a> &gt; <span class="el_source">BookshelfEvent.java</span></div><h1>BookshelfEvent.java</h1><pre class="source lang-java linenums">package io.github.team10.escapefromuni;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.Input;
import com.badlogic.gdx.graphics.Color;
import com.badlogic.gdx.graphics.Texture;
import com.badlogic.gdx.graphics.g2d.GlyphLayout;
import com.badlogic.gdx.graphics.g2d.Sprite;

/**
 * NEW FOR ASSESSMENT 2.
 * This class is a hidden event
 * It moves the player into another room by interacting with it
 */
public class BookshelfEvent implements IEvent {
  private final Player player;
  private final RoomFlowManager roomFlow;
<span class="nc" id="L18">  private boolean isFinished = false;</span>
  private Sprite bookshelfSprite;
  private Texture bookshelfTexture;
  private final EscapeGame game;
  private final Room destinationRoom;
  private final EventSystem eventSystem;

  /**
   * NEW FOR ASSESSMENT 2.
   * This is the class constructor for BookShelfEvent
   * It initalises the aspects of the game needed for the event
   *
   * @param player the player controlled by the user
   * @param roomFlow the manager for room transitions
   * @param destinationRoom the desired room to head to
   * @param game the main LibGDX game instance
   * @param eventSystem the central events manager
   */
  public BookshelfEvent(Player player, RoomFlowManager roomFlow,
<span class="nc" id="L37">      Room destinationRoom, EscapeGame game, EventSystem eventSystem) {</span>
<span class="nc" id="L38">    this.player = player;</span>
<span class="nc" id="L39">    this.roomFlow = roomFlow;</span>
<span class="nc" id="L40">    this.game = game;</span>
<span class="nc" id="L41">    this.destinationRoom = destinationRoom;</span>
<span class="nc" id="L42">    this.eventSystem = eventSystem;</span>
<span class="nc" id="L43">  }</span>

  /**
   * NEW FOR ASSESSMENT 2.
   * This returns the type of event, hidden
   */
  @Override
  public EventType getType() {
<span class="nc" id="L51">    return EventType.HIDDEN;</span>
  }

  /**
   * NEW FOR ASSESSMENT 2.
   * This starts the event in the game
   * It loads the texture and sprite as well as setting the position of it
   */
  @Override
  public void startEvent() {
    // creates the sprit and loads in the events texture
<span class="nc" id="L62">    bookshelfTexture = new Texture(&quot;GreggsSausageRoll.png&quot;);</span>
<span class="nc" id="L63">    bookshelfSprite = new Sprite(bookshelfTexture);</span>

    // sets the sprite to invinsible
<span class="nc" id="L66">    bookshelfSprite.setAlpha(0f);</span>

    // calculates the position for the sprite as well as its size
<span class="nc" id="L69">    bookshelfSprite.setSize(1f, 2f);</span>
<span class="nc" id="L70">    float roomWidth = game.viewport.getWorldWidth();</span>
<span class="nc" id="L71">    float roomHeight = game.viewport.getWorldHeight();</span>
<span class="nc" id="L72">    bookshelfSprite.setPosition(roomWidth - bookshelfSprite.getWidth(),</span>
<span class="nc" id="L73">        roomHeight / 2f - bookshelfSprite.getHeight() / 2f);</span>
<span class="nc" id="L74">  }</span>

  /**
   * NEW FOR ASSESSMENT 2.
   * This ends the event by disposing of its texture
   */
  @Override
  public void endEvent() {
<span class="nc" id="L82">    bookshelfTexture.dispose();</span>
<span class="nc" id="L83">  }</span>

  /**
   * NEW FOR ASSESSMENT 2.
   * This handles the events logic
   * It transports the player to the given room chosen
   */
  @Override
  public void update(float delta) {
<span class="nc bnc" id="L92" title="All 2 branches missed.">    if (isFinished) {</span>
<span class="nc" id="L93">      return;</span>
    }

    // checks the player is interacting with the bookshelf and it touching it
<span class="nc bnc" id="L97" title="All 4 branches missed.">    if (player.checkCollision(bookshelfSprite) &amp;&amp; Gdx.input.isKeyJustPressed(Input.Keys.F)) {</span>
<span class="nc" id="L98">      eventSystem.registerEvent(EventType.HIDDEN);</span>
      // changes the room to desired destination
<span class="nc" id="L100">      roomFlow.changeRoomTo(destinationRoom);</span>
<span class="nc" id="L101">      isFinished = true;</span>

      // removes the door to the bookshelf room upon visiting it
      // this means players do not get stuck in the room
<span class="nc bnc" id="L105" title="All 2 branches missed.">      if (!roomFlow.bookshelfRoomVisited()) {</span>
<span class="nc" id="L106">        Room bookshelfRoom = roomFlow.getRoomByName(&quot;hiddenBookshelfRoom&quot;);</span>
<span class="nc" id="L107">        Room room4 = roomFlow.getRoomByName(&quot;room4&quot;);</span>
        // removes the enterence to the room
<span class="nc" id="L109">        roomFlow.removeEnterence(bookshelfRoom, room4, DoorDirection.EAST);</span>
      }

    }
<span class="nc" id="L113">  }</span>

  /**
   * NEW FOR ASSESSMENT 2.
   * This draws the sprite into the game
   */
  @Override
  public void draw() {
<span class="nc bnc" id="L121" title="All 2 branches missed.">    if (!isFinished) {</span>
<span class="nc" id="L122">      bookshelfSprite.draw(game.batch);</span>
    }
<span class="nc" id="L124">  }</span>

  /**
   * NEW FOR ASSESSMENT 2.
   * This draws the UI for the event
   * Displays a hint to help user find event
   */
  @Override
  public void drawUI() {
<span class="nc bnc" id="L133" title="All 4 branches missed.">    if (!isFinished &amp;&amp; player.checkCollision(bookshelfSprite)) {</span>

      // sets the font and size of the text
<span class="nc" id="L136">      game.font.getData().setScale(1f);</span>
<span class="nc" id="L137">      game.font.setColor(Color.BLACK);</span>

<span class="nc" id="L139">      String message = &quot;Something looks off here...&quot;;</span>

      // Calculates text layout for propper positioning
<span class="nc" id="L142">      GlyphLayout layout = new GlyphLayout(game.font, message);</span>

<span class="nc" id="L144">      float uiWidth = game.uiViewport.getWorldWidth();</span>
<span class="nc" id="L145">      float uiHeight = game.uiViewport.getWorldHeight();</span>

      // centres the text horizontally and positions it to the top of the screen
<span class="nc" id="L148">      float textX = (uiWidth - layout.width) / 2f;</span>
<span class="nc" id="L149">      float textY = uiHeight * 0.9f;</span>

      // Draws the message
<span class="nc" id="L152">      game.font.draw(game.batch, layout, textX, textY);</span>

      // Resets the ui for other messages
<span class="nc" id="L155">      game.font.getData().setScale(1.1f);</span>
<span class="nc" id="L156">      game.font.setColor(Color.WHITE);</span>

    }
<span class="nc" id="L159">  }</span>

  /**
   * NEW FOR ASSESSMENT 2.
   * This returns if the game is finished or not
   */
  @Override
  public boolean IsFinished() {
<span class="nc" id="L167">    return isFinished;</span>
  }

}


</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>