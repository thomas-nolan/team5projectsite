<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core</a> &gt; <a href="index.source.html" class="el_package">io.github.team10.escapefromuni</a> &gt; <span class="el_source">GameController.java</span></div><h1>GameController.java</h1><pre class="source lang-java linenums">package io.github.team10.escapefromuni;

/**
 * NEW FOR ASSESSMENT 2.
 * Acts as the central controller for the logic of the game
 * Responsible for coordinating core system like the player controller,
 * room flow, events, doors, scoring, timing and achievements.
 */
public class GameController {
  private final EscapeGame game;
  private final UIController uiController;

  private Player player;
  private PlayerController playerController;
  private final ScoreManager scoreManager;
  private final Timer timer;

  private final EventSystem eventSystem;
  private RoomFlowManager roomFlow;
  private DoorController doorController;
  private final AchievementManager achievementManager;

  /**
   * NEW FOR ASSESSMENT 2.
   * Creates a new GameController and initialises the core game systems.
   *
   * @param game the main LibGDX game instance
   * @param uiController the UI controller used to manage screens
   */
<span class="nc" id="L30">  public GameController(EscapeGame game, UIController uiController) {</span>

<span class="nc" id="L32">    this.game = game;</span>
<span class="nc" id="L33">    this.uiController = uiController;</span>

    // All the core gameplay systems
<span class="nc" id="L36">    this.timer = new Timer();</span>
<span class="nc" id="L37">    this.scoreManager = new ScoreManager();</span>
<span class="nc" id="L38">    this.achievementManager = new AchievementManager();</span>
<span class="nc" id="L39">    this.eventSystem = new EventSystem();</span>

    // Sets up the player as well as its controller
<span class="nc" id="L42">    this.player = new Player(3f, 1f, 1f, game);</span>
<span class="nc" id="L43">    this.playerController = new PlayerController(game, player);</span>

    // Sets up the room and door manager
<span class="nc" id="L46">    this.roomFlow = new RoomFlowManager(game, this.uiController, playerController,</span>
        null, eventSystem, scoreManager, timer, achievementManager);
<span class="nc" id="L48">    this.doorController = new DoorController(game, playerController, roomFlow, eventSystem);</span>
<span class="nc" id="L49">    this.roomFlow.setDoorController(doorController);</span>

    // Initialises the map and all the rooms
<span class="nc" id="L52">    roomFlow.initialiseMap();</span>
<span class="nc" id="L53">  }</span>

  /**
   * NEW FOR ASSESSMENT 2.
   * Updates the games logic every frame
   *
   * @param delta the time elapsed between frames
   */
  public void update(float delta) {
<span class="nc" id="L62">    roomFlow.update(delta); // NEW FOR ASSESSMENT 2 - processes player input</span>
    // NEW FOR ASSESSMENT 2 - checks if the player has touched a door and needs to change room
<span class="nc" id="L64">    doorController.update();</span>
<span class="nc" id="L65">    eventSystem.update(delta); // NEW FOR ASSESSMENT 2 - checks if the event has been activated</span>
<span class="nc" id="L66">    timer.update(delta); // NEW FOR ASSESSMENT 2 - updates the timer</span>
<span class="nc" id="L67">  }</span>

  /**
   * NEW FOR ASSESSMENT 2.
   * Draws all the world UI for the game
   */
  public void drawWorld() {
<span class="nc" id="L74">    roomFlow.drawCurrentRoom(); // NEW FOR ASSESSMENT 2 - draws the current room</span>
<span class="nc" id="L75">    doorController.draw(); // NEW FOR ASSESSMENT 2 - draws the doors</span>
<span class="nc" id="L76">    playerController.drawPlayer(); // NEW FOR ASSESSMENT 2 - draws the player</span>
<span class="nc" id="L77">    eventSystem.drawWorld(); // NEW FOR ASSESSMENT 2 - draws the event</span>
<span class="nc" id="L78">  }</span>

  /**
   * NEW FOR ASSESSMENT 2.
   * Draws all the UI for each frame
   *
   * @param game the main LibGDX game instance
   */
  public void drawUI(EscapeGame game) {
<span class="nc" id="L87">    eventSystem.drawUI(); // renders the ui</span>
<span class="nc" id="L88">    doorController.drawUI();</span>
<span class="nc" id="L89">    game.font.draw(this.game.batch, &quot;Time: &quot;</span>
<span class="nc" id="L90">        + timer.getTimeLeftSeconds()</span>
        + &quot;s&quot;, 75f, 1000f); // draws remaining time

<span class="nc" id="L93">    game.font.draw(this.game.batch,</span>
<span class="nc" id="L94">        &quot;Negative events: &quot; + eventSystem.getTriggered(EventType.NEGATIVE)</span>
<span class="nc" id="L95">        +  &quot;/&quot; + eventSystem.getMax(EventType.NEGATIVE),</span>
        50f, 950f);

<span class="nc" id="L98">    game.font.draw(this.game.batch,</span>
<span class="nc" id="L99">        &quot;Positive events: &quot; + eventSystem.getTriggered(EventType.POSITIVE)</span>
<span class="nc" id="L100">        +  &quot;/&quot; + eventSystem.getMax(EventType.POSITIVE),</span>
        50f, 910f);

<span class="nc" id="L103">    game.font.draw(this.game.batch,</span>
<span class="nc" id="L104">        &quot;Hidden events: &quot; + eventSystem.getTriggered(EventType.HIDDEN)</span>
<span class="nc" id="L105">        +  &quot;/&quot; + eventSystem.getMax(EventType.HIDDEN),</span>
        50f, 870f);
<span class="nc" id="L107">  }</span>

  /**
   * EXTENDED FROM ASSESSMENT 1.
   * Resets the game to its initial state, allowing the player to replay it.
   */
  public void resetGame() {
    // Dispose old resources
<span class="nc" id="L115">    roomFlow.dispose();</span>
<span class="nc" id="L116">    doorController.dispose();</span>
<span class="nc" id="L117">    player.dispose();</span>

    // Reset timer and score
<span class="nc" id="L120">    timer.reset();</span>
<span class="nc" id="L121">    scoreManager.reset();</span>

<span class="nc" id="L123">    eventSystem.reset();</span>

    // Recreate the player
<span class="nc" id="L126">    Player newPlayer = new Player(3f, 1f, 1f, game);</span>
<span class="nc" id="L127">    this.player = newPlayer;</span>
<span class="nc" id="L128">    this.playerController = new PlayerController(game, newPlayer);</span>

    // Recreate door controller (important!)
<span class="nc" id="L131">    this.doorController = new DoorController(game, playerController, null, eventSystem);</span>

    // Recreate room flow manager and connect it with the new doorController
<span class="nc" id="L134">    this.roomFlow = new RoomFlowManager(game, uiController, playerController,</span>
        doorController, eventSystem, scoreManager, timer, achievementManager);
<span class="nc" id="L136">    roomFlow.setDoorController(doorController);</span>
<span class="nc" id="L137">    doorController.setRoomFlowManager(roomFlow);</span>

    // Initialise rooms and events
<span class="nc" id="L140">    roomFlow.initialiseMap();</span>
<span class="nc" id="L141">  }</span>

  /**
   * Frees up the memory used by the systems.
   */
  public void dispose() {
<span class="nc" id="L147">    roomFlow.dispose();</span>
<span class="nc" id="L148">    doorController.dispose();</span>
<span class="nc" id="L149">    playerController.dispose();</span>
<span class="nc" id="L150">  }</span>

  /**
   * Returns the timer object.
   *
   * @return the {@link Timer} object
   */
  public Timer getTimer() {
<span class="nc" id="L158">    return timer;</span>
  }

  public ScoreManager getScoreManager() {
<span class="nc" id="L162">    return scoreManager;</span>
  }

  public EventSystem getEventSystem() {
<span class="nc" id="L166">    return eventSystem;</span>
  }

  public Player getPlayer() {
<span class="nc" id="L170">    return player;</span>
  }

  public AchievementManager getAchievementManager() {
<span class="nc" id="L174">    return achievementManager;</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>