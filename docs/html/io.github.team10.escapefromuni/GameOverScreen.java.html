<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameOverScreen.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core</a> &gt; <a href="index.source.html" class="el_package">io.github.team10.escapefromuni</a> &gt; <span class="el_source">GameOverScreen.java</span></div><h1>GameOverScreen.java</h1><pre class="source lang-java linenums">package io.github.team10.escapefromuni;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.Input;
import com.badlogic.gdx.Screen;
import com.badlogic.gdx.graphics.Color;
import com.badlogic.gdx.graphics.Texture;
import com.badlogic.gdx.graphics.g2d.BitmapFont;
import com.badlogic.gdx.graphics.g2d.GlyphLayout;
import com.badlogic.gdx.utils.ScreenUtils;
import java.io.IOException;

/**
 * Represents the Game Over screen, shown when the player either wins or loses.
 * Displays the appropriate background, score, and time information.
 * The player can return to the main menu by pressing the ESC key.
 */
public class GameOverScreen implements Screen {

  private final EscapeGame game;
  private final UIController uiController;
  private final boolean isWon;
  private final Timer timer;
  private final ScoreManager scoreManager;
  private final AchievementManager achievementManager;
  private final EventSystem eventSystem;

  private final BitmapFont font;
  private final Texture winScreen;
  private final Texture loseScreen;

<span class="nc" id="L32">  private boolean leaderboardsSaved = false;</span>

  /**
   * EXTENDED ON FROM ASSESSMENT 1.
   * Constructs a new GameOVerScreen.
   *
   * @param game  The main game instance.
   * @param isWon Whether the player has won or lost.
   * @param timer The timer used to track playtime.
   * @param scoreManager  The score manager which calculates the final score.
   */
  public GameOverScreen(final EscapeGame game, UIController uiController,
      boolean isWon, Timer timer, ScoreManager scoreManager,
<span class="nc" id="L45">      AchievementManager achievementManager, EventSystem eventSystem) {</span>

    // NEW FOR ASSESSMENT 2 - Sets up the core systems and managers used for the game over screen
<span class="nc" id="L48">    this.game = game;</span>
<span class="nc" id="L49">    this.uiController = uiController;</span>
<span class="nc" id="L50">    this.isWon = isWon;</span>
<span class="nc" id="L51">    this.timer = timer;</span>
<span class="nc" id="L52">    this.scoreManager = scoreManager;</span>
<span class="nc" id="L53">    this.achievementManager = achievementManager;</span>
<span class="nc" id="L54">    this.eventSystem = eventSystem;</span>

    // NEW FOR ASSESSMENT 2 - Loads in the win and loose screens.
<span class="nc" id="L57">    this.font = game.font;</span>
<span class="nc" id="L58">    this.winScreen = new Texture(&quot;WinScreen.png&quot;);</span>
<span class="nc" id="L59">    this.loseScreen = new Texture(&quot;LoseScreen.png&quot;);</span>
<span class="nc" id="L60">  }</span>

  /**
   * EXTENDED FROM ASSESSMENT 1.
   * This renders the end game screen and handles its logic
   */
  @Override
  public void render(float delta) {
    // Return to main menu if ESC pressed.
<span class="nc bnc" id="L69" title="All 2 branches missed.">    if (Gdx.input.isKeyJustPressed(Input.Keys.ESCAPE)) {</span>
      // NEW FOR ASSESSMENT 2 - used to reset the achievements and show main menu
<span class="nc" id="L71">      achievementManager.reset();</span>
<span class="nc" id="L72">      uiController.showMainMenu();</span>
<span class="nc" id="L73">      dispose();</span>
<span class="nc" id="L74">      return;</span>
    }

<span class="nc" id="L77">    ScreenUtils.clear(Color.BLACK);</span>
<span class="nc" id="L78">    game.uiViewport.apply();</span>
<span class="nc" id="L79">    game.batch.setProjectionMatrix(game.uiCamera.combined);</span>
<span class="nc" id="L80">    game.batch.begin();</span>

    // Renders the screen depending on if the player has won
<span class="nc bnc" id="L83" title="All 2 branches missed.">    if (isWon) {</span>
      try {
<span class="nc" id="L85">        renderWinScreen();</span>
<span class="nc" id="L86">      } catch (IOException e) {</span>
<span class="nc" id="L87">        throw new RuntimeException(e);</span>
<span class="nc" id="L88">      }</span>
    } else {
<span class="nc" id="L90">      renderLoseScreen();</span>
    }
<span class="nc" id="L92">    game.batch.end();</span>
<span class="nc" id="L93">  }</span>

  /**
   * EXTENDED FROM ASSESSMENT 1.
   * Renders the winning screen, showing the win background, final score and time elapsed.
   */
  private void renderWinScreen() throws IOException {
<span class="nc" id="L100">    game.batch.draw(winScreen, 0, 0, game.uiViewport.getWorldWidth(),</span>
<span class="nc" id="L101">        game.uiViewport.getWorldHeight());</span>
<span class="nc" id="L102">    final String timeText = &quot;Time Elapsed: &quot; + timer.getTimeSeconds();</span>

    // NEW FOR ASSESSMENT 2
    // Calculates the score and saves it into the leaderboard
<span class="nc" id="L106">    checkAchievements(timer.getTimeLeftSeconds());</span>
<span class="nc" id="L107">    int finalScore = scoreManager.CalculateFinalScore(timer.getTimeLeftSeconds(),</span>
        achievementManager);
<span class="nc bnc" id="L109" title="All 2 branches missed.">    if (leaderboardsSaved == false) {</span>
<span class="nc" id="L110">      scoreManager.leaderboards(finalScore);</span>
<span class="nc" id="L111">      leaderboardsSaved = true;</span>
    }
<span class="nc" id="L113">    final String scoreText = &quot;Score: &quot; + finalScore;</span>

<span class="nc" id="L115">    game.font.setColor(Color.BLACK);</span>
<span class="nc" id="L116">    GlyphLayout layout = new GlyphLayout();</span>

<span class="nc" id="L118">    float uiWidth = game.uiViewport.getWorldWidth();</span>
<span class="nc" id="L119">    float uiHeight = game.uiViewport.getWorldHeight();</span>

    // Draw time elapsed text
<span class="nc" id="L122">    layout.setText(game.font, timeText);</span>
<span class="nc" id="L123">    float timeX = (uiWidth - layout.width) / 2f;</span>
<span class="nc" id="L124">    float timeY = uiHeight * 0.35f;</span>
<span class="nc" id="L125">    game.font.draw(game.batch, layout, timeX, timeY);</span>

    // Draw score text
<span class="nc" id="L128">    layout.setText(game.font, scoreText);</span>
<span class="nc" id="L129">    float scoreX = (uiWidth - layout.width) / 2f;</span>
<span class="nc" id="L130">    float scoreY = uiHeight * 0.3f;</span>
<span class="nc" id="L131">    font.draw(game.batch, scoreText, scoreX, scoreY);</span>

<span class="nc" id="L133">    displayAchievements();</span>

<span class="nc" id="L135">  }</span>

  /**
   * Renders the losing screen with the lose background.
   * Doesn't display the score or time.
   */
  private void renderLoseScreen() {
<span class="nc" id="L142">    game.batch.draw(loseScreen, 0, 0,</span>
<span class="nc" id="L143">        game.uiViewport.getWorldWidth(), game.uiViewport.getWorldHeight());</span>
<span class="nc" id="L144">  }</span>

  /**
   * NEW FOR ASSESSMENT 2.
   * This checks the achievements completed and gives a new achievement if the time
   * completed is short enough.
   *
   * @param timeLeftSeconds The time left on the timer after completing the game
   */
  public void checkAchievements(int timeLeftSeconds) {

<span class="nc bnc" id="L155" title="All 2 branches missed.">    if (timeLeftSeconds &gt; 270) {</span>
<span class="nc" id="L156">      achievementManager.addAchievement(&quot;Speedrun&quot;);</span>
    }

    // Adds 'All positive events' achievement
<span class="nc bnc" id="L160" title="All 2 branches missed.">    if (eventSystem.getTriggered(EventType.POSITIVE) &gt;= eventSystem.getMax(EventType.POSITIVE)) {</span>
<span class="nc" id="L161">      achievementManager.addAchievement(&quot;All positive events&quot;);</span>
    }

    // Adds 'All negative events' achievement
<span class="nc bnc" id="L165" title="All 2 branches missed.">    if (eventSystem.getTriggered(EventType.NEGATIVE) &gt;= eventSystem.getMax(EventType.NEGATIVE)) {</span>
<span class="nc" id="L166">      achievementManager.addAchievement(&quot;All negative events&quot;);</span>
    }

    // Adds 'All hidden events' achievement
<span class="nc bnc" id="L170" title="All 2 branches missed.">    if (eventSystem.getTriggered(EventType.HIDDEN) &gt;= eventSystem.getMax(EventType.HIDDEN)) {</span>
<span class="nc" id="L171">      achievementManager.addAchievement(&quot;All hidden events&quot;);</span>
    }


<span class="nc" id="L175">  }</span>

  /**
   * NEW FOR ASSESSMENT 2.
   * This displays all the Achievements completed
   */
  public void displayAchievements() {

    // NEW FOR ASSESSMENT 2
    // Gets the coordinates for the placement of the Achievements on the end screen
<span class="nc" id="L185">    float achievementY = game.uiViewport.getWorldHeight() - 20;</span>
<span class="nc" id="L186">    String[] achievements = achievementManager.getAchievements();</span>
<span class="nc" id="L187">    font.draw(game.batch, &quot;Achievements: &quot;, 20, achievementY);</span>

    // NEW FOR ASSESSMENT 2 - places each achievement below each other.
<span class="nc bnc" id="L190" title="All 2 branches missed.">    for (int i = 0; i &lt; achievements.length; i++) {</span>
<span class="nc" id="L191">      achievementY -= 50;</span>
<span class="nc" id="L192">      font.draw(game.batch, achievements[i], 20, achievementY);</span>
    }
<span class="nc" id="L194">  }</span>

<span class="nc" id="L196">  @Override public void show() {}</span>

<span class="nc" id="L198">  @Override public void resize(int width, int height) {}</span>

<span class="nc" id="L200">  @Override public void pause() {}</span>

<span class="nc" id="L202">  @Override public void resume() {}</span>

<span class="nc" id="L204">  @Override public void hide() {}</span>

  /**
   * Dispose of textures used by the screen.
   */
  @Override
  public void dispose() {
<span class="nc" id="L211">    winScreen.dispose();</span>
<span class="nc" id="L212">    loseScreen.dispose();</span>
<span class="nc" id="L213">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>