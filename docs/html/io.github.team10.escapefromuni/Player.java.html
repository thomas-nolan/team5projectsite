<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Player.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core</a> &gt; <a href="index.source.html" class="el_package">io.github.team10.escapefromuni</a> &gt; <span class="el_source">Player.java</span></div><h1>Player.java</h1><pre class="source lang-java linenums">package io.github.team10.escapefromuni;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.Input;
import com.badlogic.gdx.graphics.Color;
import com.badlogic.gdx.graphics.Texture;
import com.badlogic.gdx.graphics.g2d.BitmapFont;
import com.badlogic.gdx.graphics.g2d.GlyphLayout;
import com.badlogic.gdx.graphics.g2d.Sprite;
import com.badlogic.gdx.math.Vector2;
import jdk.internal.org.jline.utils.DiffHelper;

/**
 * Represents the player character.
 *
 * Handles player rendering, movement and collision detection.
 */
public class Player {
    public Texture playerTexture;
    public Sprite playerSprite;
    public float speed;
    public EscapeGame game;
    private boolean movementEnabled;
<span class="nc" id="L24">    private boolean textureDisposed = false;</span>
<span class="nc" id="L25">    private boolean hasKey = false;</span>
<span class="nc" id="L26">    private boolean invincible = false;</span>
<span class="nc" id="L27">    private float invincibiltyTime = 0f;</span>
    private BitmapFont font;
<span class="nc" id="L29">    private DifficultySetup difficultySetup = new DifficultySetup();</span>

<span class="nc" id="L31">    private final float EDGE_LIMIT = 1f;</span>

    /**
     * Creates a new player instance.
     * @param speed The player's movement speed (world units per second).
     * @param playerWidth The width of the player in world units.
     * @param playerHeight The height of the player in world units.
     * @param game Reference to the main {@link EscapeGame} instance.
     */
    public Player(float speed, float playerWidth, float playerHeight, EscapeGame game)
<span class="nc" id="L41">    {</span>
<span class="nc" id="L42">        this.speed = speed * (difficultySetup.readDifficulty().playerSpeedModifier);</span>
<span class="nc" id="L43">        this.game = game;</span>
<span class="nc" id="L44">        this.movementEnabled = true;</span>

<span class="nc" id="L46">        font = new BitmapFont();</span>

<span class="nc" id="L48">        loadTexture(playerWidth, playerHeight);</span>
<span class="nc" id="L49">    }</span>

    private void loadTexture(float width, float height){
<span class="nc bnc" id="L52" title="All 4 branches missed.">        if(playerTexture != null &amp;&amp; !textureDisposed){</span>
<span class="nc" id="L53">            playerTexture.dispose();</span>
        }

<span class="nc" id="L56">        playerTexture = new Texture(&quot;MalePlayer.png&quot;);</span>
<span class="nc" id="L57">        playerSprite = new Sprite(playerTexture);</span>
<span class="nc" id="L58">        playerSprite.setSize(width, height);</span>

        // Center the player
<span class="nc" id="L61">        float centerX = game.viewport.getWorldWidth() / 2f;</span>
<span class="nc" id="L62">        float centerY = game.viewport.getWorldHeight() / 2f;</span>
<span class="nc" id="L63">        playerSprite.setCenter(centerX, centerY);</span>
<span class="nc" id="L64">    }</span>

    public void reset(float playerWidth, float playerHeight){
<span class="nc" id="L67">        loadTexture(playerWidth, playerHeight);</span>
<span class="nc" id="L68">    }</span>

    public void setInvincible(float duration){
<span class="nc" id="L71">        invincible = true;</span>
<span class="nc" id="L72">        invincibiltyTime = duration;</span>
<span class="nc" id="L73">    }</span>

    public boolean isInvincible(){
<span class="nc" id="L76">        return invincible;</span>
    }

    /**
     * Called every frame to perform player logic.
     * @param delta The time in seconds since the last frame.
     */
    public void update(float delta)
    {
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if (movementEnabled)</span>
        {
<span class="nc" id="L87">            move(delta);</span>
        }

<span class="nc bnc" id="L90" title="All 2 branches missed.">        if(invincible){</span>
<span class="nc" id="L91">            invincibiltyTime -= delta;</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">            if(invincibiltyTime &lt;= 0){</span>
<span class="nc" id="L93">                invincible = false;</span>
<span class="nc" id="L94">                invincibiltyTime = 0;</span>
            }
        }
<span class="nc" id="L97">    }</span>

    /**
     * Handles player movement and constrains movement to within screen edge boundaries.
     *
     * Uses arrow key input. Center of player remains at least {@link #EDGE_LIMIT} units from the world edges.
     * @param delta The time in seconds since the last frame.
     */
    private void move(float delta) {
<span class="nc" id="L106">        float worldWidth = game.viewport.getWorldWidth();</span>
<span class="nc" id="L107">        float worldHeight = game.viewport.getWorldHeight();</span>
<span class="nc" id="L108">        float halfWidth = playerSprite.getWidth() / 2f;</span>
<span class="nc" id="L109">        float halfHeight = playerSprite.getHeight() / 2f;</span>
<span class="nc" id="L110">        float playerCenterX = playerSprite.getX() + halfWidth;</span>
<span class="nc" id="L111">        float playerCenterY = playerSprite.getY() + halfHeight;</span>

<span class="nc bnc" id="L113" title="All 4 branches missed.">        if (Gdx.input.isKeyPressed(Input.Keys.RIGHT) || Gdx.input.isKeyPressed(Input.Keys.D)) {</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">            if (playerCenterX &lt; worldWidth - EDGE_LIMIT) {</span>
<span class="nc" id="L115">                playerSprite.translateX(speed * delta);</span>
            }
        }
<span class="nc bnc" id="L118" title="All 4 branches missed.">        if (Gdx.input.isKeyPressed(Input.Keys.LEFT) || Gdx.input.isKeyPressed(Input.Keys.A)) {</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">            if (playerCenterX &gt; EDGE_LIMIT) {</span>
<span class="nc" id="L120">                playerSprite.translateX(-speed * delta);</span>
            }
        }
<span class="nc bnc" id="L123" title="All 4 branches missed.">        if (Gdx.input.isKeyPressed(Input.Keys.UP) || Gdx.input.isKeyPressed(Input.Keys.W)) {</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">            if (playerCenterY &lt; worldHeight - EDGE_LIMIT) {</span>
<span class="nc" id="L125">                playerSprite.translateY(speed * delta);</span>
            }
        }
<span class="nc bnc" id="L128" title="All 4 branches missed.">        if (Gdx.input.isKeyPressed(Input.Keys.DOWN) || Gdx.input.isKeyPressed(Input.Keys.S)) {</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">            if (playerCenterY &gt; EDGE_LIMIT) {</span>
<span class="nc" id="L130">                playerSprite.translateY(-speed * delta);</span>
            }
        }
<span class="nc" id="L133">    }</span>

    /**
     * Allows enabling or disabling movement for the player.
     * @param enabled boolean representing whether the player will be able to move.
     */
    public void enableMovement(boolean enabled)
    {
<span class="nc" id="L141">        this.movementEnabled = enabled;</span>
<span class="nc" id="L142">    }</span>

    /**
     * Draws the player sprite.
     */
    public void draw() {
<span class="nc bnc" id="L148" title="All 2 branches missed.">        if(!textureDisposed){</span>
<span class="nc" id="L149">            playerSprite.draw(game.batch);</span>
        }

<span class="nc" id="L152">    }</span>

    public void drawUI(){
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if(invincible){</span>
<span class="nc" id="L156">            font.getData().setScale(4f);</span>
<span class="nc" id="L157">            font.setColor(Color.GREEN);</span>

<span class="nc" id="L159">            String message = &quot;Invincible! &quot; + (int)Math.ceil(invincibiltyTime) + &quot;s&quot;;</span>

<span class="nc bnc" id="L161" title="All 2 branches missed.">            if(!game.batch.isDrawing()) {</span>
<span class="nc" id="L162">                game.batch.begin();</span>
            }

<span class="nc" id="L165">            float uiWidth = game.uiViewport.getWorldWidth();</span>
<span class="nc" id="L166">            float uiHeight = game.uiViewport.getWorldHeight();</span>

<span class="nc" id="L168">            float textX = uiWidth / 2f - message.length() * 4f;</span>
<span class="nc" id="L169">            float textY = uiHeight * 0.9f;</span>

<span class="nc" id="L171">            font.draw(game.batch, message, textX, textY);</span>
        }
<span class="nc" id="L173">    }</span>

    /**
     * Checks whether the player has collided (overlaps) with another sprite.
     * @param objectSprite The other object's sprite.
     * @return boolean representing whether collision has occured.
     */
    public boolean checkCollision(Sprite objectSprite)
    {
<span class="nc" id="L182">        return playerSprite.getBoundingRectangle().overlaps(objectSprite.getBoundingRectangle());</span>
    }

    /**
     * Dispose of player texture to free GPU memory.
     *
     * Should be called when the GameScreen is disposed.
     */
    public void dispose()
    {
<span class="nc bnc" id="L192" title="All 4 branches missed.">        if(playerTexture != null &amp;&amp; !textureDisposed){</span>
<span class="nc" id="L193">            playerTexture.dispose();</span>
        }
<span class="nc" id="L195">    }</span>

    /**
     * Set the position of the player sprite, updating from the bottom left corner.
     * @param x The x-coord of new position.
     * @param y The y-coord of new position.
     */
    public void setPosition(float x, float y)
    {
<span class="nc" id="L204">        playerSprite.setPosition(x, y);</span>
<span class="nc" id="L205">    }</span>

    /**
     * Sets the center position of the player sprite.
     * @param x The x-coord of the new position.
     * @param y The y-coord of the new position.
     */
    public void setCenter(float x, float y)
    {
<span class="nc" id="L214">        playerSprite.setCenter(x, y);</span>
<span class="nc" id="L215">    }</span>

    /**
     * Return the center position of the player sprite, as a Vector2.
     */
    public Vector2 getCenter()
    {
<span class="nc" id="L222">        float centerX = playerSprite.getX() + playerSprite.getWidth() / 2f;</span>
<span class="nc" id="L223">        float centerY = playerSprite.getY() + playerSprite.getHeight() / 2f;</span>
<span class="nc" id="L224">        return new Vector2(centerX, centerY);</span>
    }

    /**
     * Increase the player's speed by a fixed amount.
     * @param speedIncrease the amount by which the speed will increase.
     */
    public void increaseSpeed(float speedIncrease)
    {
<span class="nc" id="L233">        speed += speedIncrease;</span>
<span class="nc" id="L234">    }</span>

    public void giveKey(){
<span class="nc" id="L237">        hasKey = true;</span>
<span class="nc" id="L238">    }</span>

    public boolean hasKey(){
<span class="nc" id="L241">        return hasKey;</span>
    }

    public void useKey(){
<span class="nc" id="L245">        hasKey = false;</span>
<span class="nc" id="L246">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>